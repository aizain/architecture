# 爬网站

> http://map.bjsubway.com:8080/subwaymap2/public/
```
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="csrf-token" content="lyHqnd58kIwc8DZTmmP5Ziyq9TFN1aOJqiXjK67D">

        <title>北京地铁</title>

        <!-- Meta -->
        <meta name="description" content="Laravel 5 Boilerplate">
        <meta name="author" content="Anthony Rappa">
        
        <!-- Styles -->
        
        <!-- Check if the language is set to RTL, so apply the RTL layouts -->
        <!-- Otherwise apply the normal LTR layouts -->
                    <link media="all" type="text/css" rel="stylesheet" href="http://map.bjsubway.com:8080/subwaymap2/public/css/frontend.d81050145ba26e502d8273a09e14ce8b.css">

        
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?01cf1cc88df5ecf7e38164197b4a2001";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<style type="text/css">
    body {
        overflow: hidden;
        font-family: '微软雅黑';
    }

    .tt-menu {
      width: 296px;
      margin: 12px 0px;
      margin-left: -20px;
      padding: 8px 0;
      background-color: #fff;
      border: 1px solid #ccc;
      border: 1px solid rgba(0, 0, 0, 0.2);
      overflow-y: auto;
    }

    .tt-suggestion {
      padding: 3px 20px;
      font-size: 14px;
      line-height: 24px;
    }

    .tt-suggestion:hover {
      cursor: pointer;
      color: #fff;
      background-color: #0097cf;
    }

    .tt-suggestion.tt-cursor {
      color: #fff;
      background-color: #0097cf;

    }

    .tt-suggestion p {
      margin: 0;
    }

    .station-hover {
        width: 314px;
        position: absolute;
        color: white;
        z-index: 100;
        left: 0px;
        top: 0px;
        display: none;
    }

    .linereal-hover {
        width: 251px;
        height: 95px;
        position: absolute;
        color: white;
        z-index: 100;
        left: 0px;
        top: 0px;
        display: none;
    }

    .search-btn {
        width: 90px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        background-color: #ffffff;
        float: left;
        cursor: pointer;
    }

    .search-btn.active {
        background-color: #e4f3fa;
    }

    .search-wrap-btn {
        width: 60px;
        height: 20px;
        line-height: 20px;
        margin-top: 5px;
        text-align: center;
        background-color: #3798cb;
        color: white;
        font-size: 10px;
        float: right;
        cursor: pointer;
    }

    .line {
        width: 269px;
        height: 19px;
        margin-left: 5px;
    }

    .line_img {
        width:14px; 
        height:15px; 
        float: left; 
        background-image: url(http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/subway_blue.png);
        background-repeat:  no-repeat;
        background-size: contain;
        margin-top: 3px;
    }

    .line_start {
        width: 255px; 
        height: 19px;
        float: left; 
        margin-left: 0px; 
        font-size: 12px; 
        line-height: 19px; 
        font-weight: bold; 
        padding-left: 5px;
    }

    .line_cont {
        width: 200px; 
        margin-left: 11px;
        margin-top: -5px; 
        margin-bottom: -5px;
        border-left: 1px; 
        border-left-color: #3798cb;
        border-left-style: dashed; 
        height: auto; 
        color: #c2047e; 
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        font-size: 12px;
        font-family: "微软雅黑";
    }

    .line_cont ul {
        list-style: none;
        padding-left: 0px; 
    }
</style>

        <!-- Scripts -->
        <script>
            window.Laravel = {"csrfToken":"lyHqnd58kIwc8DZTmmP5Ziyq9TFN1aOJqiXjK67D"}        </script>
    </head>
    <body id="app-layout">
        <div id="app">
            <div class="container-fluid">
                    
    <nav id="navbar" class="navbar navbar-default navbar-fixed-top" style="border: 0px;">
        <div class="row">
            <div class="col-xs-12" style="background-color: #3798cb; height: 70px; padding: 0px;">
                <img onclick="window.open('http://www.bjsubway.com','_self')" src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/logo.png" style="cursor: pointer;"  />
                <div class="pull-right">
                    <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/north_white.png" style="height: 50px; width: 26px; margin-right: 30px; margin-top: 10px;" />
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12" id="topInfo" style="background-color: #1e80c1; height: 30px; padding: 0px;">
                <div class="pull-left" id="scrollInfo" style="margin-left: 35px; font-size: 13px; line-height: 30px; color: white;">
                    <marquee id="scrollText"></marquee>
                </div>
                <div class="pull-right" id="linksInfo" style="margin-right: 80px; font-size: 13px; line-height: 30px; color: white;">
                    <a href="http://www.bjsubway.com/" style="color: white; text-decoration: none; cursor: pointer;">首页</a>&nbsp;&nbsp;| &nbsp;&nbsp;
                    <a href="http://www.bjsubway.com/support/xxgkzn/2013-12-13/1297.html" style="color: white; text-decoration: none; cursor: pointer;">信息公开</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                    <a href="http://www.bjsubway.com/job/" style="color: white; text-decoration: none; cursor: pointer;">人才招聘</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                    <a href="http://www.bjsubway.com/contact/" style="color: white; text-decoration: none; cursor: pointer;">联系我们</a>
                </div>
            </div>
        </div>
    </nav>
    <div class="row">
        <div class="col-xs-12" style="padding: 0px;">
            <div class="subwaymap">
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/turn.png" id="turn_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/block.png" id="block_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/start.png" id="start_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/end.png" id="end_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/tam.png" id="tam_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/zhizuo.jpg" id="zhizuo_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/north.png" id="north_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/airport.png" id="airport_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/block.png" id="block_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/arrow.png" id="arrow_icon" style="display:none;"/>
                <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/arrow_2.png" id="arrow2_icon" style="display:none;"/>
                <div id="subway_map" class="subway-map" style="background-color: white;"></div>
                <div class="mapimgs" id="container"></div>
            </div>
        </div>
    </div>
    <div id="stationHover" class="station-hover station-hover-info">
        <table class="station-hover-info">
            <tr class="station-hover-info"><td colspan="3" style="width: 314px; height: 42px; background: url('http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/stationhover_top.png'); background-size: contain; padding-left: 30px;" class="station-hover-info">
                <div id="stationHoverName" style="margin-top: -8px;" class="station-hover-info"></div>
            </td></tr>
            <tr class="station-hover-info">
                <td style="width: 13px; background: url('http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/stationhover_left.png') repeat-y; background-size: contain;" class="station-hover-info"></td>
                <td style="background-color: white; background-image: url('http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/stationhover_fill.png'); background-repeat: no-repeat; background-size: contain; background-position: bottom left;" class="station-hover-info">
                    <div id="stationHoverInfos" style="max-height: 170px; height: 170px; -ms-overflow-y: scroll; overflow-y: scroll;" class="station-hover-info"></div>
                </td>
                <td style="width: 15px; background: url('http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/stationhover_right.png') repeat-y; background-size: contain;" class="station-hover-info"></td>
            </tr>
            <tr class="station-hover-info"><td colspan="3" style="width: 314px; height: 35px; background: url('http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/stationhover_bottom.png'); background-size: contain;" class="station-hover-info"></td></tr>
        </table>
    </div>
    <div id="stationPop" style="position: fixed; z-index: 100; width: 207px; height: 73px; display: none;">
        <div style="position: absolute; left: 0px; top: 0px;" class="station-pop">
            <div class="station-pop"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/setse.png" style="width: 207px; height: 73px;" class="station-pop"/></div>
        </div>
        <div style="position: absolute; cursor: pointer; left: 26px; top: 29px; width: 70px; height: 29px;" class="station-pop" onclick="setFromStation()"></div>
        <div style="position: absolute; cursor: pointer; left: 114px; top: 29px; width: 70px; height: 29px;" class="station-pop" onclick="setToStation()"></div>
    </div>
    <div id="linesDiv" style="position: fixed; z-index: 90; width: 92px; right: 9px; top: 100px; overflow: hidden;">
        <div id="lineWrap" style="position: absolute; width: 92px; height: 56px; top: 0px;">
            <div id="lineWrapUp" style="position: absolute; height: 56px; text-align: center; cursor: pointer;" onclick="toggleLines('up')"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/lineup.png" style="height: 56px; width: 92px;"></div>
            <div id="lineWrapDown" style="position: absolute; height: 56px; text-align: center; cursor: pointer; display: none;" onclick="toggleLines('down')"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/linedown.png" style="height: 56px; width: 92px;"></div>
        </div>
        <div id="lineList" style="position: absolute; background-color: #ffffff; width: 80px; left: 6px; top: 60px;">
            <div style="height: 35px; text-align: center; cursor: pointer;" onclick="scrollLineList('up')"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/arrow_up.png" style="height: 35px; width: 80px;"></div>
            <div id="lineswrap" style="overflow: hidden; position: relative;">
                <div id="lines" style="position: absolute; top: 0px;"></div>
            </div>
            <div style="height: 35px; text-align: center; cursor: pointer;" onclick="scrollLineList('down')"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/arrow_down.png" style="height: 35px; width: 80px;"/></div>
        </div>
    </div>
    <div id="zoomBtns" style="position: fixed; z-index: 90; right: 26px; bottom: 40px; width: 57px; height: 145px;">
        <div style="position: absolute; left: 0px; top: 0px;">
            <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/zoomback.png" style="height: 145px; width: 57px;">
        </div>
        <div style="position: absolute; cursor: pointer; left: 19px; top: 17px;" onclick="zoomMap('in')">
            <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/zoomin.png" style="height: 18px; width: 18px;">
        </div>
        <div style="position: absolute; cursor: pointer; left: 19px; top: 60px;" onclick="zoomMap('out')">
            <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/zoomout.png" style="height: 18px; width: 18px;">
        </div>
        <div style="position: absolute; cursor: pointer; left: 19px; top: 105px;" onclick="fullScreen()">
            <img id="fullicon" src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/fullon.png" style="height: 18px; width: 18px;">
        </div>
    </div>
    <div id="realSwitch" style="position: fixed; top: 120px; right: 120px; height: 27px;">
        <div id="realOff" style="position: absolute; top: 0px; right: 0px; cursor: pointer;" onclick="switchRealTime('on')"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/realoff.png" style="height: 60px; width: 94px;" /></div>
        <div id="realOn" style="position: absolute; top: 0px; right: 0px; display: none;">
            <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/realon.png" style="height: 60px; width: 418px;" />
            <div style="position: absolute; right: 10px; top: 5px; width: 60px; height: 60px; cursor: pointer;" onclick="switchRealTime('off')"></div>
        </div>
    </div>
    <div id="lineRealHover" class="linereal-hover">
        <div id="lineRealHover_Bg_green" style="position: absolute; left: 0px; top: 0px; display: none;"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/green.png" style="width: 251px;" /></div>
        <div id="lineRealHover_Bg_yellow" style="position: absolute; left: 0px; top: 0px; display: none;"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/yellow.png" style="width: 251px;" /></div>
        <div id="lineRealHover_Bg_red" style="position: absolute; left: 0px; top: 0px; display: none;"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/red.png" style="width: 251px;" /></div>
        <div id="lineRealHover_Bg_black" style="position: absolute; left: 0px; top: 0px; display: none;"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/black.png" style="width: 251px;" /></div>
        <div id="lineRealHover_name" style="position: absolute; left: 30px; top: 5px;"></div>
        <div id="lineRealHover_info" style="position: absolute; left: 45px; top: 33px; height: 50px;">
            <table style="width: 100%; height: 100%;"><tr><td style="vertical-align: middle; width: 100%; height: 100%;"></td></tr></table>
        </div>
    </div>
    <div id="stationForm" style="position: fixed; top: 120px; left: 20px; display: ;">
        <div style="position: absolute;">
            <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/station.png" style="height: 80px; width: 296px;" />    
        </div>
        <div style="position: absolute; left: 20px; top: 35px;">
            <input id="station" type="text" placeholder="输入站点名称" style="height: 30px; line-height: 30px; width: 260px; border: 0px; outline: none;" />
        </div>
        <div id="stationinfo" style="display: none; position: absolute; left: 0px; top: 85px; background-color: #3798cb; width: 296px;">
            <div>
                <div id="stationname" style="max-width: 200px; float: left; color: white; padding: 10px;">
                    <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/subway.png" style="width: 14px;" />&nbsp;&nbsp;<span></span>
                </div>
                <div style="float: right; font-size: 12px; color: #3798cb;">
                    <div style="background-color: white; margin: 10px 10px; padding: 3px; cursor: pointer;" onclick="setFromStation()">
                        <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/from.png" style="height: 14px;">
                        从这站出发
                    </div>
                    <div style="background-color: white; margin: 10px 10px; padding: 3px; cursor: pointer;" onclick="setToStation()">
                        <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/to.png" style="height: 14px;">
                        到这站去
                    </div>
                </div>
                <div style="clear: both;"></div>
            </div>
            <div id="stationinfos" style="overflow-x: hidden; overflow-y: auto;"></div>
        </div>
    </div>
    <div id="searchForm" style="position: fixed; top: 120px; left: 20px; display: none;">
        <div style="position: absolute;">
            <img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/search.png" style="width: 296px; height: 134px;" />
        </div>
        <div onclick="changeFromTo()" style="position: absolute; left: 20px; top: 62px; width: 20px; height: 30px; cursor: pointer;"></div>
        <div onclick="cancelSearch()" style="position: absolute; left: 250px; top: 0px; width: 45px; height: 30px; cursor: pointer;"></div>
        <div style="position: absolute; left: 55px; top: 49px;">
            <input id="stationFrom" type="text" placeholder="输入站点名称" style="height: 25px; line-height: 25px; width: 210px; border: 0px; background-color: #e3f1fa; outline: none;" />
        </div>
        <div style="position: absolute; left: 55px; top: 81px;">
            <input id="stationTo" type="text" placeholder="输入站点名称" style="height: 25px; line-height: 25px; width: 210px; border: 0px; background-color: #e3f1fa; outline: none;" />
        </div>
        <div id="searchResult" style="display: none; position: absolute; left: 0px; top: 134px; background-color: #ffffff; width: 296px; border: 1px solid #3798cb; border-bottom: 30px solid #3798cb;">
            <div style="width: 274px; height: 30px; margin: 10px 10px 0px 10px;">
                <div class="search-btn active" id="mintime" onclick="switchMintype('time')">较快捷</div>
                <div class="search-btn" id="minhc" onclick="switchMintype('hc')">少换乘</div>
                <div class="search-wrap-btn" id="detailinfo">展开详情+</div>
                <div class="clear"></div>
            </div>
            <div style="width: 274px; margin: 0px 10px 0px 10px; background-color: #e4f3fa;">
                <!--
                <div style="" id="exchangeInfos"><img src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/icons/0.png" style="height: 14px;" /></div>
                -->
                <div style="height: 30px; line-height: 30px; color: #757472; font-size: 11px; width: 285px;">
                    <div id="statime" style="float: left; margin-left: 5px;">• 29分钟</div>
                    <div id="stanum" style="float: left; margin-left: 5px;">• 途径10站</div>
                    <div id="extime" style="float: left; margin-left: 5px;">• 换乘3次</div>
                    <div id="staprice" style="float: left; margin-left: 5px;">• 票价4元</div>
                    <div class="clear"></div>
                </div>
            </div>
            <div id="resultInfos" style="overflow-x: hidden; overflow-y: auto; margin: 0px 10px 10px 10px; padding-top: 10px; background-color: #e4f3fa; height: 100px;"></div>
            <div id="resultText" style="overflow-x: hidden; overflow-y: auto; margin: 0px 10px 10px 10px; padding: 5px; background-color: #e4f3fa; height: 100px;">
                <textarea id="resultContent" style="height: 60px; width: 100%; font-size: 12px;"></textarea>
                <button class="btn" style="height: 20px; font-size: 12px; background-color: lightgray; padding: 0px 10px;" data-clipboard-target="#resultContent">
                    复制乘车方案
                </button>
            </div>
        </div>
    </div>
    <nav id="delayinfo" style="height: 170px; width: 300px; position: fixed; left: 2px; bottom: 37px; display: none;">
        <div style="height: 26px; line-height: 26px; width: 300px; background-color: #3b8ec0; border-top-left-radius: 10px; border-top-right-radius: 10px; padding-left: 10px;">
            <a href="http://www.bjsubway.com/support/ywgz/" style="color: white; font-size: 13px; text-decoration: none;">详情<font color="yellow">>>>></font></a>
        </div>
        <div id="delayinfo_content" style="height: 118px; width: 300px; max-width: 300px; background-color: #3798cb; background-image: url(http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/subway_back.png); background-repeat: no-repeat; background-position: bottom left; border-top: 1px solid white; border-bottom: 1px solid white; overflow-y: auto; padding: 10px; color: white; font-size: 13px;">
        </div>
        <div style="height: 26px; width: 300px; background-color: #3b8ec0; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
            <div style="text-align: right;">
                <img onclick="closeDelayInfo()" src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/close_white.png" style="width: 20px; height: 20px; margin-right: 5px; margin-top: 2px; cursor: pointer;" />
            </div>
        </div>
    </nav>
    <nav id="navbottom" class="navbar navbar-default navbar-fixed-bottom" style="height: 35px; min-height: 35px; border: 0px;">
        <div class="row">
            <div class="col-xs-12 text-center" style="background-color: #3798cb; height: 35px; line-height: 35px; padding: 0px; color: white; font-size: 12px;">
                注：本网站乘车方案中所提供的时间为预计时间，不包含候车等待时间，请您提前做好出行安排。七号线双井站暂缓开通。
            </div>
        </div>
    </nav>
            </div><!-- container -->
        </div><!--#app-->

        <!-- Scripts -->
                <script src="http://map.bjsubway.com:8080/subwaymap2/public/js/frontend.2f4d4fa10be3819a0fbf.js"></script>

            <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/svg/svg.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/svg/svg-pan-zoom.min.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/hammer/hammer.min.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/typeahead/typeahead.jquery.min.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/layer/layer.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/fullscreen/fullscreen.min.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/vendor/clipboard/clipboard.min.js"></script>
    <script src="http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/subwaymap.js?v=1"></script>
    <script type="text/javascript">
        var overStationHover = false;
        var overStationDot = false;
        var overStationPop = false;
        var overRealLine = false;
        var checkXml = null;
        var lastDelayTime = null;

        var findLineUrl = "http://map.bjsubway.com:8080/subwaymap2/public/api/searchfromto";
        var getPriceUrl = "http://map.bjsubway.com:8080/subwaymap2/public/api/getprice";
        var searchLineUrl = "http://map.bjsubway.com:8080/subwaymap2/public/api/searchstartend";
        var getRealUrl = "http://map.bjsubway.com:8080/subwaymap2/public/api/getrealdatas";
        var getBlockUrl = "http://map.bjsubway.com:8080/subwaymap2/public/api/getblocks";
        var getDelayUrl = "http://map.bjsubway.com:8080/subwaymap2/public/api/getdelay";

        $(function() {
            //FastClick.attach(document.body);
            $(".subway-map").subwayMap({ 
                debug: false,
                getRealUrl: getRealUrl,
                getBlockUrl: getBlockUrl,
                showStationInfo: function(station, block, sx, sy, scale) {
                    overStationDot = true;
                    setTimeout(function(){showStationHover(station, block, sx, sy, scale);}, 300);
                },
                hideStationInfo: function() {
                    overStationDot = false;
                    if (overStationHover == false)
                        setTimeout('hideStationHover()', 300);
                },
                forceHideStationInfo: function() {
                    forceHideStationHover();
                    forceHideStationPop();
                },
                showLineRealInfo: function(lineinfo, sx, sy) {
                    overRealLine = true;
                    setTimeout(function(){showLineHover(lineinfo, sx, sy);}, 300);
                },
                hideLineRealInfo: function() {
                    overRealLine = false;
                    $("#lineRealHover").hide();
                },
                selectStation: function(station, sx, sy) {
                    forceHideStationHover();

                    if ($("#searchForm").css("display") == "none") {
                        var oldStation = $("#station").val();
                        if (oldStation != station) {
                            $('#station').typeahead('val', station);
                            showStationInfo(station);
                        }

                        $("#stationPop").show();
                        $("#stationPop").css("left", sx - $("#stationPop").width()/2);
                        $("#stationPop").css("top", sy);
                    } else {
                        if ($("#stationFrom").val() == "") {
                            $('#stationFrom').typeahead('val', station);
                            $(".subway-map").subwayMap("setFromTo", {'ft': 'from', 'station': station});
                        } else if ($("#stationTo").val() == "") {
                            $('#stationTo').typeahead('val', station);
                            $(".subway-map").subwayMap("setFromTo", {'ft': 'to', 'station': station});
                        }
                        
                        if ($("#stationFrom").val() != "" && $("#stationTo").val() != "") {
                            submits();
                        }
                    }
                },
                clearSearch: function() {
                    cancelSearch();
                }
            });

            checkXml = setInterval('checkXmlLoaded()', 1000);
            
            checkDelayInfo();
            setInterval('checkDelayInfo()', 60000);

            $("#linesDiv").css("height", window.innerHeight - 290);
            $("#lineList").css("height", window.innerHeight - 340);
            $("#lineswrap").css("height", $("#lineList").height() - 80);

            $("#stationHover").bind("mouseover", function(evt) {
                evt.preventDefault();
                evt.stopPropagation();
                overStationHover = true;
            });

            $("#stationHover").bind("mouseout", function(evt) {
                evt.preventDefault();
                evt.stopPropagation();
                if (evt.relatedTarget != undefined) {
                    if ($(evt.relatedTarget).hasClass('station-hover-info'))
                        return;
                }

                overStationHover = false;
                setTimeout('hideStationHover()', 300);
            });

            $("#stationPop").bind("mouseout", function(evt) {
                evt.preventDefault();
                evt.stopPropagation();
                if (evt.relatedTarget != undefined) {
                    if ($(evt.relatedTarget).hasClass('station-pop'))
                        return;
                }

                overStationPop = false;
                setTimeout('hideStationPop()', 300);
            });

            $("#detailinfo").click(function() {
                $("#resultInfos").find("ul").slideToggle("fast");
                if ($("#detailinfo").text() == "关闭详情-") {
                    $("#detailinfo").text("展开详情+");
                } else {
                    $("#detailinfo").text("关闭详情-");
                }
            });
        });

        function showStationHover(station, block, sx, sy, scale) {
            if (overStationDot == false)
                return;

            var oldStation = $("#stationHoverName").text();
            $("#stationHoverName").text(station);
            $('#stationHoverInfos').empty();
            if (block != null) {
                var bts = block.split("|");
                var btstr = "";
                for (var i=0; i< bts.length; i++)
                    btstr += bts[i]+"&nbsp;&nbsp;";
                $('#stationHoverInfos').append("<div style='color: red; margin-left: 10px;' class='station-hover-info'>限流时间：<br/>"+btstr+"</div>");
            }
            var infos = $(".subway-map").subwayMap('getStationInfo', {'station': station});
            if (infos.length > 0) {
                var info = "";
                for (var i=0; i<infos.length; i++) {
                    var arr = infos[i].split("||||||");
                    var name = infos[i].split("::::::")[0];
                    var color = $(".subway-map").subwayMap('getLineColor', {'line': name});
                    info += "<div style='margin: 5px; margin-top: 0px; padding: 10px 0px;' class='station-hover-info'><div style='border-bottom: 1px solid "+color+";' class='station-hover-info'><span style='padding: 4px; background-color: "+color+"; color: white;' class='station-hover-info'>"+name+"</span></div>";
                    for (var a=0; a<arr.length; a++) {
                        var fes = arr[a].split("::::::");
                        info += "<div style='margin-top: 10px;' class='station-hover-info'>"+fes[1]+"</div>";
                        for (var f=2; f<fes.length; f++)
                            info += "<div style='font-size: 12px;' class='station-hover-info'>"+fes[f].replace(/、/g, " ")+"</div>";
                    }
                    info += "</div>";
                }
                info = "<div style='color: black;' class='station-hover-info'>"+info+"</div>";
                $('#stationHoverInfos').append(info);

                if ($("#stationHover").css("display") == 'none' || oldStation != station) {
                    $('#stationHoverInfos').scrollTop(0);
                    $("#stationHover").show();
                    //overStationHover = true;
                    $("#stationHover").css("left", sx);
                    $("#stationHover").css("top", sy - $("#stationHover").height() - 3*scale);
                    $("#stationHoverInfos").css("overflow-y", "scroll");
                }
            }
        }

        function showLineHover(lineinfo, sx, sy) {
            if (overRealLine == false)
                return;

            var oldLine = $("#lineRealHover_name").text();
            var lineinfos = lineinfo.split(",");
            var infostr = "";
            $("#lineRealHover_Bg_green").hide();
            $("#lineRealHover_Bg_yellow").hide();
            $("#lineRealHover_Bg_red").hide();
            if (lineinfos[2] == "green") {
                lineinfo = "路段畅通";
                $("#lineRealHover_Bg_green").show();
            } else if (lineinfos[2] == "yellow") {
                lineinfo = "路段客流较大";
                $("#lineRealHover_Bg_yellow").show();
            } else if (lineinfos[2] == "red") {
                lineinfo = "路段客流拥堵";
                $("#lineRealHover_Bg_red").show();
            } else if (lineinfos[2] == "black") {
                lineinfo = "路段客流极拥堵";
                $("#lineRealHover_Bg_black").show();
            }
            
            if ($("#lineRealHover").css("display") == 'none' || oldLine != ("开往"+lineinfos[1]+"方向")) {
                $("#lineRealHover_name").text("开往"+lineinfos[1]+"方向");
                $('#lineRealHover_info').find("td").text(lineinfos[0]+" - "+lineinfos[1]+lineinfo);
                $("#lineRealHover").show();
                $("#lineRealHover").css("left", sx);
                $("#lineRealHover").css("top", sy - $("#lineRealHover").height());
            }
        }

        function showStationInfo(station) {
            $('#station').blur();
            $('#stationname').find('span').text(station);
            $('#stationinfos').empty();
            $('#stationinfos').css('max-height', window.innerHeight - 345);

            var infos = $(".subway-map").subwayMap('getStationInfo', {'station': station});
            if (infos.length > 0) {
                var info = "";
                for (var i=0; i<infos.length; i++) {
                    var arr = infos[i].split("||||||");
                    var name = infos[i].split("::::::")[0];
                    info += "<div style='margin: 10px; margin-top: 0px; padding: 10px 0px; border-top: 1px solid white;'><div><span style='padding: 5px; background-color: white; color: #3798cb;'>"+name+"<span></div>";
                    for (var a=0; a<arr.length; a++) {
                        var fes = arr[a].split("::::::");
                        info += "<div style='margin-top: 10px;'>"+fes[1]+"</div>";
                        for (var f=2; f<fes.length; f++)
                            info += "<div style='font-size: 12px;'>"+fes[f].replace(/、/g, " ")+"</div>";
                    }
                    info += "</div>";
                }
                info = "<div style='color: white;'>"+info+"</div>";
                $('#stationinfos').append(info);
            }

            $('#stationinfo').show();
        }

        function hideStationHover() {
            if (overStationHover == false && overStationDot == false)
                $("#stationHover").hide();
        }

        function forceHideStationHover() {
            overStationHover = false;
            overStationDot = false;
            $("#stationHover").hide();
        }

        function hideStationPop() {
            if (overStationPop == false)
                $("#stationPop").hide();
        }

        function forceHideStationPop() {
            $("#stationPop").hide();
        }

        function checkXmlLoaded() {
            var stations = [];
            stations = $(".subway-map").subwayMap('getStations');
            if (stations.length > 0) {
                clearInterval(checkXml);
                
                $('#station').typeahead(
                    {
                        hint: false,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'stations',
                        source: substringMatcher(stations),
                        limit: 500
                    }
                );

                $('#station').bind('typeahead:select', function(ev, suggestion) {
                    showStationInfo(suggestion);
                });

                $('#station').bind('typeahead:open', function(ev) {
                    $('.tt-menu').css('margin-top', '12px');
                    $('.tt-menu').css('margin-left', '-20px');
                    $('.tt-menu').css('max-height', window.innerHeight - 245);
                });

                $('#station').bind('input propertychange', function(ev) {
                    var nowStationName = $("#stationname").find('span').text();
                    if (nowStationName == "")
                        return;

                    if ($.trim($('#station').val()) != nowStationName) {
                        $('#stationinfo').hide();
                        $("#stationname").find('span').text("");
                        $('#stationinfos').empty();
                    }
                });

                //stationFrom
                $('#stationFrom').typeahead(
                    {
                        hint: false,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'stations',
                        source: substringMatcher(stations),
                        limit: 500
                    }
                );

                $('#stationFrom').bind('typeahead:select', function(ev, suggestion) {
                    $('#stationFrom').blur();
                    if ($('#stationFrom').val() != "" && $('#stationTo').val() != "")
                        submits();
                });

                //stationTo
                $('#stationTo').typeahead(
                    {
                        hint: false,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'stations',
                        source: substringMatcher(stations),
                        limit: 500
                    }
                );

                $('#stationTo').bind('typeahead:select', function(ev, suggestion) {
                    $('#stationTo').blur();
                    if ($('#stationFrom').val() != "" && $('#stationTo').val() != "")
                        submits();
                });

                $('#stationFrom').bind('typeahead:open', function(ev) {
                    $('.tt-menu').css('margin-top', '60px');
                    $('.tt-menu').css('margin-left', '-55px');
                    $('.tt-menu').css('max-height', window.innerHeight - 310);
                });

                $('#stationTo').bind('typeahead:open', function(ev) {
                    $('.tt-menu').css('margin-top', '28px');
                    $('.tt-menu').css('margin-left', '-55px');
                    $('.tt-menu').css('max-height', window.innerHeight - 310);
                });


                var lines = $(".subway-map").subwayMap('getLines');
                $("#lines").empty();
                for (var i=0; i<lines.length; i++) {
                    $("#lines").append("<div style='cursor: pointer; background-color: "+lines[i].color+"; width: 80px; color: white; margin: 1px 0px; font-size: 12px; text-align: center; padding:6px 0px;' onclick=\"focusLine('"+lines[i].name+"')\">"+lines[i].name+"</div>");
                }
            }
        }

        var substringMatcher = function(strs) {
            return function findMatches(q, cb) {
                var matches, substringRegex;
                // an array that will be populated with substring matches
                matches = [];
                // regex used to determine if a string contains the substring `q`
                substrRegex = new RegExp(q, 'i');
                // iterate through the pool of strings and for any string that
九月 15, 2017 7:56:54 下午 io.vertx.core.impl.launcher.commands.VertxIsolatedDeployer
信息: Succeeded in deploying verticle
                // contains the substring `q`, add it to the `matches` array
                $.each(strs, function(i, str) {
                    if (substrRegex.test(str)) {
                        matches.push(str);
                    }
                });

                cb(matches);
            };
        };

        function setFromStation() {
            showSearchForm("from");
        }

        function setToStation() {
            showSearchForm("to");
        }

        function showSearchForm(ft) {
            $("#stationForm").hide();
            $("#searchForm").show();
            if (ft == "from") {
                $("#stationFrom").typeahead("val", $("#station").val());
                $("#stationTo").typeahead("val" ,"");
            }
            else {
                $("#stationTo").typeahead("val", $("#station").val());
                $("#stationFrom").typeahead("val", "");
            }

            $(".subway-map").subwayMap("setFromTo", {'ft': ft, 'station': $("#station").val()});

            $("#stationPop").hide();
        }

        function changeFromTo() {
            var s = $("#stationFrom").val();
            $("#stationFrom").typeahead("val", $("#stationTo").val());
            $("#stationTo").typeahead("val", s);

            if ($("#stationFrom").val() != "" && $("#stationTo").val() != "")
                submits();
            else {
                if ($("#stationFrom").val() != "")
                    $(".subway-map").subwayMap("setFromTo", {'ft': 'from', 'station': $("#stationFrom").val()});
                else
                    $(".subway-map").subwayMap("setFromTo", {'ft': 'to', 'station': $("#stationTo").val()});
            }
        }

        function cancelSearch() {
            $(".subway-map").subwayMap("removeMapMask", {});

            $("#searchForm").hide();
            $("#searchResult").hide();
            $("#resultInfos").hide();

            $("#stationForm").show();

            $("#station").typeahead("val", "");
            $("#station").blur();
            $('#stationinfo').hide();
            $("#stationname").find('span').text("");
            $('#stationinfos').empty();
        }

        function focusLine(line) {
            $(".subway-map").subwayMap('highlightLine', {'line': line});
        }

        var isfinding = false;
        var jc_start_s = "";
        var jc_end_s = "";

        function switchMintype(mintype) {
            if (!$("#min"+mintype).hasClass('active')) {
                $("#mintime").toggleClass('active');
                $("#minhc").toggleClass('active');
                submits();
            }
        }

        /*
        function submits() {
            if (isfinding == true)
                return;
            
            $(".subway-map").subwayMap("removeMapMask", {});

            showFinding();

            isfinding = true;

            huanchengSearch();

            var start_s = $("#stationFrom").val();
            var end_s = $("#stationTo").val();
            
            if (start_s != "" && (start_s == end_s)) {
                clearLineSearch();
                setTimeout(function(){alert("起点和终点不能为同一座车站！");}, 1000);
                return;
            }
            
            if (start_s == "2号航站楼") {
                jc_start_s = start_s;
                jc_end_s = end_s;
                if (end_s == "3号航站楼") {
                    clearLineSearch();
                    setTimeout(function(){alert("2号航站楼去往3号航站楼需搭乘中转摆渡车！");}, 1000);
                }
                else {
                    start_s = "三元桥";
                    var param = {"start":start_s,
                                "end":end_s,
                                "mintype":$("#mintime").hasClass('active')?"time":"hc"};
                    $.get(findLineUrl, param,callbackFun_FindLineJC);
                }
                return;
            }
            
            if (start_s == "3号航站楼") {
                jc_start_s = start_s;
                jc_end_s = end_s;
                if (end_s != "2号航站楼") {
                    start_s = "三元桥";
                    var param = {"start":start_s,
                                "end":end_s,
                                "mintype":$("#mintime").hasClass('active')?"time":"hc"};
                    $.get(findLineUrl,param,callbackFun_FindLineJC);

                    return;
                }
            }
            
            var param = {"start":start_s,
                        "end":end_s,
                        "mintype":$("#mintime").hasClass('active')?"time":"hc"};
            $.get(findLineUrl,param,callbackFun_FindLine);
        }

        //机场线处理
        var jc_shijian_1 = 0;
        var jc_huancheng_1 = 0;
        var jc_shijian_2 = 0;
        var jc_huancheng_2 = 0;
        var jc_hclines = null;
        function callbackFun_FindLineJC(data) {
            jc_shijian_1 = 0;
            jc_huancheng_1 = 0;
            jc_shijian_2 = 0;
            jc_huancheng_2 = 0;
            jc_hclines = data;
            var huancheng = eval(data);
            for(var i=0;i<huancheng.length;i++) {
                var zs = 1;
                if (i != 0) {
                    //exchange
                    jc_shijian_1 += getExchangeTime(huancheng[i-1][0][0],huancheng[i-1][huancheng[i-1].length-1][1],huancheng[i][0][0]);
                }
                jc_shijian_1 = jc_shijian_1 + huancheng[i][0][2];
                for(var j=1;j<huancheng[i].length-1;j++) {
                    if (trimStr(huancheng[i][j][1]) == "" || huancheng[i][j][4] == "false") 
                        continue;
                    
                    zs++;
                    jc_shijian_1 = jc_shijian_1 + huancheng[i][j][2];
                    jc_shijian_1 = jc_shijian_1 + huancheng[i][j][5];
                }
            }
            jc_huancheng_1 = huancheng.length;

            var param = {"start":"东直门",
                        "end":jc_end_s,
                        "mintype":$("#mintime").hasClass('active')?"time":"hc"};
            $.post(findLineUrl,param,callbackFun_FindLineJC2);
        }

        function callbackFun_FindLineJC2(data) {
            var huancheng = eval(data);
            for(var i=0;i<huancheng.length;i++) {
                var zs = 1;
                if (i != 0) {
                    //exchange
                    jc_shijian_2 += getExchangeTime(huancheng[i-1][0][0],huancheng[i-1][huancheng[i-1].length-1][1],huancheng[i][0][0]);
                }
                jc_shijian_2 = jc_shijian_2 + huancheng[i][0][2];
                for(var j=1;j<huancheng[i].length-1;j++) {
                    if (trimStr(huancheng[i][j][1]) == "" || huancheng[i][j][4] == "false") 
                        continue;
                    
                    zs++;
                    jc_shijian_2 = jc_shijian_2 + huancheng[i][j][2];
                    jc_shijian_2 = jc_shijian_2 + huancheng[i][j][5];
                }
            }

            jc_huancheng_2 = huancheng.length;

            var mintype = $("#mintime").hasClass('active')?"time":"hc";
            if ((mintype == "hc" && (jc_huancheng_1 < jc_huancheng_2 || (jc_huancheng_1 == jc_huancheng_2 && jc_shijian_1 <= jc_shijian_2))) || (mintype == "time" && jc_shijian_1 <= jc_shijian_2)) {
                //var jcret = eval(jc_hclines);
                //if (jcret.length < 3)
                var str = jc_hclines;//JSON.stringify(jc_hclines);
                str = ","+str.substring(1);
                if (jc_end_s == "三元桥" || jc_end_s == "东直门")
                    str = "]";
                if (jc_start_s == "2号航站楼")
                    callbackFun_FindLine(JSON.parse('[[[15,"2号航站楼",900,6,"true",45,0],[15,"",0,7,"false",0,0],[15,"",0,8,"false",0,0],[15,"三元桥",0,9,"true",0,0]]'+str));
                else 
                    callbackFun_FindLine(JSON.parse('[[[15,"3号航站楼",240,4,"true",45,0],[15,"",0,5,"false",0,0],[15,"2号航站楼",900,6,"true",45,0],[15,"",0,7,"false",0,0],[15,"",0,8,"false",0,0],[15,"三元桥",0,9,"true",0,0]]'+str));
            }
            else {
                var str = data;//JSON.stringify(data);
                str = ","+str.substring(1);
                if (jc_end_s == "三元桥" || jc_end_s == "东直门")
                    str = "]";
                if (jc_start_s == "2号航站楼")
                    callbackFun_FindLine(JSON.parse('[[[15,"2号航站楼",900,6,"true",45,0],[15,"",0,7,"false",0,0],[15,"",0,8,"false",0,0],[15,"三元桥",240,9,"true",40,0],[15,"",0,10,"false",0,0],[15,"东直门",0,11,"true",0,0]]'+str));
                else 
                    callbackFun_FindLine(JSON.parse('[[[15,"3号航站楼",240,4,"true",45,0],[15,"",0,5,"false",0,0],[15,"2号航站楼",900,6,"true",45,0],[15,"",0,7,"false",0,0],[15,"",0,8,"false",0,0],[15,"三元桥",240,9,"true",40,0],[15,"",0,10,"false",0,0],[15,"东直门",0,11,"true",0,0]]'+str));
            }    
        }

        var hclines = null;
        var hc_jc = false;
        function callbackFun_FindLine(data) {
            $("#searchResult").show();
            $("#resultInfos").empty();
            $("#resultInfos").show();
            $("#resultInfos").css("height", $(window).height() - parseInt($("#searchForm").css("top")) - parseInt($("#searchResult").css("top")) - 200);

            hclines = data;
            var huancheng = eval(data);
            var zhanshu = 0;
            var miles = 0;
            var shijian = 0;
            var piaojia = 0;
            $("#staprice").text("• 票价"+piaojia+"元");
            if (huancheng != null) {
                var start_s = "";
                var end_s = "";
                var start_l = "";
                var end_l = "";
                hc_jc = false;
                //起点是机场线
                if (huancheng[0][0][0]==15) {
                    start_s = huancheng[0][huancheng[0].length-1][1];
                    hc_jc = true;
                    if (start_s == "三元桥")
                        start_l = "7";
                    if (start_s == "东直门")
                        start_l = "1";
                }
                else {
                    start_s = huancheng[0][0][1];
                    start_l = huancheng[0][0][0];
                }
                
                //终点是机场线
                if (huancheng[huancheng.length-1][0][0]==15) {
                    end_s = huancheng[huancheng.length-1][0][1];
                    hc_jc = true;
                    if (end_s == "三元桥")
                        end_l = "7";
                    if (end_s == "东直门")
                        end_l = "1";
                }
                else {
                    end_s = huancheng[huancheng.length-1][huancheng[huancheng.length-1].length-1][1];
                    end_l = huancheng[huancheng.length-1][0][0];
                }
                
                if (hc_jc == true && (start_s == end_s || huancheng.length == 1)) {
                    callbackFun_GetPrice(JSON.parse('{"price":"0"}'));
                }
                else {
                    var param = {"start":start_l+start_s,
                                "end":end_l+end_s};
                    $.get(getPriceUrl,param,callbackFun_GetPrice,"json");
                }
                
                for(var i=0;i<huancheng.length;i++) {
                    var zs = 1;
                    if (i != 0) {
                        //exchange
                        shijian += getExchangeTime(huancheng[i-1][0][0],huancheng[i-1][huancheng[i-1].length-1][1],huancheng[i][0][0]);
                        shijian += 60;
                    }

                    $("#resultInfos").append("<div class='line'><div class='line_img' style='background-image: url(subwaymap/icons/"+huancheng[i][0][0]+".png)'></div><div class='line_start'>"+huancheng[i][0][1]+"<span style='float:right;'>"+showtime(shijian)+"&nbsp;&nbsp;</span></div></div><div class='line_cont' style='border-left-color:"+checkcolor(huancheng[i][0][0])+";color:#000000;'>"+Lnameex(huancheng[i][0][0])+"（<span id='hcnum"+i+"'>0</span>站）<ul id='ul"+i+"'></ul></div>");
                    shijian = shijian + huancheng[i][0][2];
                    //miles = miles + parseFloat(huancheng[i][0][6]);
                    for(var j=1;j<huancheng[i].length-1;j++) {
                        if (trimStr(huancheng[i][j][1]) == "" || huancheng[i][j][4] == "false") 
                            continue;
                        
                        zs++;
                        //shijian = shijian + (huancheng[i][j-1][2]==0?huancheng[i][j-2][2]:huancheng[i][j-1][2]);
                        shijian = shijian + huancheng[i][j][2];
                        shijian = shijian + huancheng[i][j][5];
                        //miles = miles + parseFloat(huancheng[i][j][6]);
                        
                        $("#ul"+i).append("<li>"+huancheng[i][j][1]+"</li>");
                    }

                    $("#hcnum"+i).text(zs);

                    //shijian = shijian + (huancheng[i][huancheng[i].length-2][2]==0?huancheng[i][huancheng[i].length-3][2]:huancheng[i][huancheng[i].length-2][2]);
                    //shijian = shijian + huancheng[i][huancheng[i].length-1][2];
                    zhanshu += zs;
                }

                var last = huancheng[huancheng.length-1];
                $("#resultInfos").append("<div class='line'><div class='line_img' style='background-image: url(subwaymap/icons/"+last[0][0]+".png)'></div><div class='line_start'>"+last[last.length-1][1]+"<span style='float:right;'>"+showtime(shijian)+"&nbsp;&nbsp;</span></div></div>");
                $("#resultInfos").find("ul").hide();
            }
            else {
                hclines = JSON.parse("[]");
            }
            
            $("#stanum").text("• 途径"+zhanshu+"站");
            var statime = showtime(shijian);
            $("#statime").text("• "+(statime==""?"0分钟":statime));
            var extime = 0;
            if (huancheng != null)
                extime = huancheng.length - 1;
            $("#extime").text("• 换乘"+extime+"次");

            $("#exinfo").show();
            $("#detailinfo").text("展开详情+");

            resetResults();

            if ($("#realbtn").hasClass('realon')) {
                $(".subway-map").subwayMap("showRealResult", {exresult: hclines});
            } else {
                $(".subway-map").subwayMap("redraw", {exresult: hclines});
            }

            isfinding = false;
            
            hideFinding();
        }

        function callbackFun_GetPrice(data) {
            var piaojia = parseInt(data['price'])+(hc_jc==true?25:0);
            $("#staprice").text("• 票价"+piaojia+"元");
        }
        */

        function submits() {
            if (isfinding == true)
                return;
            
            $(".subway-map").subwayMap("removeMapMask", {});

            showFinding();

            huanchengSearch();

            var start_s = $("#stationFrom").val();
            var end_s = $("#stationTo").val();
            
            if (start_s != "" && (start_s == end_s)) {
                clearLineSearch();
                setTimeout(function(){alert("起点和终点不能为同一站点！"); hideFinding();}, 500);
                return;
            }

            if (start_s == "2号航站楼" && end_s == "3号航站楼") {
                clearLineSearch();
                setTimeout(function(){alert("2号航站楼去往3号航站楼需搭乘中转摆渡车！"); hideFinding();}, 500);
                return;
            }

            var start_acc= $(".subway-map").subwayMap("getStationAcc", {"station": start_s});
            var end_acc = $(".subway-map").subwayMap("getStationAcc", {"station": end_s}); 
            var lineid = $(".subway-map").subwayMap("getLineId", {"station": start_s});

            if (start_acc == "") {
                setTimeout(function(){alert("抱歉，您输入的起点站不存在！");}, 500);
                hideFinding();
                return;    
            }

            if (end_acc == "") {
                setTimeout(function(){alert("抱歉，您输入的终点站不存在！");}, 500);
                hideFinding();
                return;    
            }           

            var param = {"lid":lineid,
                        "start_acc":start_acc,
                        "end_acc":end_acc,
                        "mintype":$("#mintime").hasClass('active')?"time":"hc"};

            
            $.get(searchLineUrl, param, callbackFun_SearchLine);
        }

        function callbackFun_SearchLine(data) {
            showSearchResult(data);
            //setTimeout(function(){showSearchResult(data);}, 300);
        }

        function showSearchResult(data) {
            $("#searchResult").show();
            $("#resultInfos").empty();
            $("#resultContent").val("");
            $("#resultInfos").show();
            $("#resultInfos").css("height", $(window).height() - parseInt($("#searchForm").css("top")) - parseInt($("#searchResult").css("top")) - 260);
            $("#resultText").css("height", "100px");

            var result = eval(data);

            hclines = data["fangan"];
            var huancheng = eval(data["fangan"]);
            var zhanshu = 0;
            var miles = 0;
            var shijian = 0;
            var extext = "";

            if (huancheng != null) {
                for(var i=0;i<huancheng.length;i++) {
                    var zs = 1;
                    if (i != 0) {
                        //exchange
                        shijian += getExchangeTime(huancheng[i-1][0][0],huancheng[i-1][huancheng[i-1].length-1][1],huancheng[i][0][0]);
                        shijian += 60;
                        extext += "换乘";
                    }

                    extext += Lnameex(huancheng[i][0][0])+"（"+huancheng[i][0][1]+"－"+huancheng[i][huancheng[i].length-1][1];

                    $("#resultInfos").append("<div class='line'><div class='line_img' style='background-image: url(subwaymap/icons/"+huancheng[i][0][0]+".png)'></div><div class='line_start'>"+huancheng[i][0][1]+"<span style='float:right; padding-right: 15px;'>"+(i==0?"<img id='realbtn' src='http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/real_off.png'' style='height: 20px; width: 50px; cursor: pointer;' onclick='showRealResult()' />":showtime(shijian))+"&nbsp;&nbsp;</span></div></div><div class='line_cont' style='border-left-color:"+checkcolor(huancheng[i][0][0])+";color:#000000;'>"+Lnameex(huancheng[i][0][0])+"（<span id='hcnum"+i+"'>0</span>站）<ul id='ul"+i+"'></ul></div>");
                    shijian = shijian + huancheng[i][0][2];
                    //miles = miles + parseFloat(huancheng[i][0][6]);
                    for(var j=1;j<huancheng[i].length-1;j++) {
                        if (trimStr(huancheng[i][j][1]) == "" || huancheng[i][j][4] == "false") 
                            continue;
                        
                        zs++;
                        //shijian = shijian + (huancheng[i][j-1][2]==0?huancheng[i][j-2][2]:huancheng[i][j-1][2]);
                        shijian = shijian + huancheng[i][j][2];
                        shijian = shijian + huancheng[i][j][5];
                        //miles = miles + parseFloat(huancheng[i][j][6]);
                        
                        $("#ul"+i).append("<li>"+huancheng[i][j][1]+"</li>");
                    }

                    $("#hcnum"+i).text(zs);

                    extext += "，"+zs+"站），";
                    //shijian = shijian + (huancheng[i][huancheng[i].length-2][2]==0?huancheng[i][huancheng[i].length-3][2]:huancheng[i][huancheng[i].length-2][2]);
                    //shijian = shijian + huancheng[i][huancheng[i].length-1][2];
                    zhanshu += zs;
                }

                var last = huancheng[huancheng.length-1];
                $("#resultInfos").append("<div class='line'><div class='line_img' style='background-image: url(subwaymap/icons/"+last[0][0]+".png)'></div><div class='line_start'>"+last[last.length-1][1]+"<span style='float:right; padding-right: 15px;'>"+showtime(shijian)+"&nbsp;&nbsp;</span></div></div>");
                $("#resultInfos").find("ul").hide();
            }
            else {
                hclines = JSON.parse("[]");
            }

            extext = "【乘车方案】"+huancheng[0][0][1]+"－"+last[last.length-1][1]+"："+extext;
            extext += "预计时间"+showtime(shijian)+"，票价"+result['price']+"元。";

            $("#resultContent").val(extext);

            var clipboard = new Clipboard('.btn', {
                container: document.getElementById('#resultContent')
            });

            clipboard.on('success', function(e) {
                alert("复制乘车方案成功！");

                e.clearSelection();
            });
            
            $("#stanum").text("• 途径"+zhanshu+"站");
            var statime = showtime(shijian);
            $("#statime").text("• "+(statime==""?"0分钟":statime));
            var extime = 0;
            if (huancheng != null)
                extime = huancheng.length - 1;
            $("#extime").text("• 换乘"+extime+"次");

            $("#exinfo").show();
            $("#detailinfo").text("展开详情+");

            $("#staprice").text("• 票价"+result['price']+"元");

            resetResults();

            if ($("#realbtn").hasClass('realon')) {
                $(".subway-map").subwayMap("showRealResult", {exresult: hclines});
            } else {
                $(".subway-map").subwayMap("redraw", {exresult: hclines});
            }

            hideFinding();
        }
             
        function clearLineSearch() {
            $("#stationFrom").typeahead("val", "");
            $("#stationTo").typeahead("val", "");

            cancelSearch();

            setTimeout(function(){submits();}, 500);
        }

        function huanchengSearch() {
            $("#searchResult").hide();
            $("#resultInfos").empty();
            $("#resultInfos").hide();
        }

        function resetResults() {
            var clr = "#000000";
            var last = $(".line_img").length - 1;
            $(".line_img").each(function(index) {
                if (index < last)
                    clr = $(this).parent().css("border-left-color");

                $(this).css("border-color", clr);
            });
        }

        function showRealResult() {
            $("#realbtn").toggleClass('realon');
            if ($("#realbtn").hasClass('realon')) {
                $("#realbtn").attr("src", "http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/real_on.png");
                $(".subway-map").subwayMap("showRealResult", {exresult: hclines});
            } else {
                $("#realbtn").attr("src", "http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/real_off.png");
                $(".subway-map").subwayMap("hideRealResult", {exresult: hclines});
            }
        }

        var findingLayer = null;
        function showFinding() {
            isfinding = true;
            findingLayer = layer.open({
                type: 3,
                shade: [0.85, '#FFFFFF'],
                shadeClose: false,
            });
        }

        function hideFinding() {
            isfinding = false;
            layer.close(findingLayer);
        }

        function getExchangeTime(fl,s,tl) {
            return $(".subway-map").subwayMap('getExchangeTime', {'fl': fl, 's': s, 'tl': tl});
        }

        function Lnameex(line) {
            return $(".subway-map").subwayMap('getLineNameById', {'line': line});
        }

        function checkcolor(line) {
            return $(".subway-map").subwayMap('getLineColorById', {'line': line});
        }

        function showtime(sec){
            if (sec == 0)
                return "";
            else {
                var hour=Math.floor(sec/3600);
                var min=Math.floor((sec-3600*hour)/60);
                var secs=sec-hour*3600-min*60;
                if (secs >= 30) {
                    min += 1;
                    if (min == 60) {
                        min = 0;
                        hour += 1;
                    }
                }
                if(hour>0) {
                    if (min == 0)
                        return "约"+hour+"小时";
                    else
                        return "约"+hour+"小时"+min+"分钟";
                }
                else
                    return "约"+min+"分钟";
            }
        }

        function trimStr(str)
        {
            str = str + "";
            str = str.replace(/'/g,"''");
            return $.trim(str);
        }

        function switchRealTime(status) {
            if (status == "on") {
                $("#realOff").hide();
                $("#realOn").show();
                $("#stationHover").hide();
                $(".subway-map").subwayMap('showRealTime');
                cancelSearch();
                $("#stationForm").hide();
            } else {
                $("#realOn").hide();
                $("#realOff").show();
                $("#lineRealHover").hide();
                $(".subway-map").subwayMap('hideRealTime');
                cancelSearch();
                $("#stationForm").show();
            }
        }

        function scrollLineList(dir) {
            var top = parseInt($("#lines").css("top"));
            var height = parseInt($("#lineswrap").css("height"));
            var theight = parseInt($("#lines").outerHeight());

            if (theight <= height)
                return;

            if (dir == "up") {
                if ((-top+20) > (theight - height))
                    $("#lines").css("top", (height - theight)+"px");
                else
                    $("#lines").css("top", (top-20)+"px");
            } else {
                if ((top + 20) > 0)
                    $("#lines").css("top", "0px");
                else
                    $("#lines").css("top", (top+20)+"px");
            }
        }

        function zoomMap(io) {
            $(".subway-map").subwayMap("zoomMap", {'io': io});
        }

        function fullScreen() {
            if ($.fullscreen.isFullScreen() == false) {
                $("body").fullscreen();
            } else {
                $.fullscreen.exit();
            }
        }

        function checkDelayInfo() {
            if (lastDelayTime == null) {
                var now = new Date();
                lastDelayTime = parseInt(now.getTime()/1000);
            }

            $.get(getDelayUrl+"?ts="+lastDelayTime, null, function(data) {
                var info = eval(data);
                if (info.title != $("#scrollText").text()) {
                    if (info.titleurl != "")
                        $("#scrollText").html("<a href='"+info.titleurl+"' target='_blank' style='color: white; text-decoration: none;'>"+info.title+"</a>");
                    else
                        $("#scrollText").text(info.title);
                    document.getElementById("scrollText").start();
                }
                /*
                var infos = eval(data);
                
                var delayStr = "";
                for (var i=0; i<infos.length; i++) {
                    var info = infos[i];

                    delayStr += "<div style='border-bottom: 1px solid white; padding-bottom:5px; margin-bottom:5px;'>"+info.title+"</div>";
                    delayStr += "<div style=''>"+info.info+"</div>";
                    delayStr += "<div style=''><br/></div>";

                    lastDelayTime = parseInt(info.infots);
                }

                if (delayStr != "") {
                    $("#delayinfo_content").html(delayStr);
                    $("#delayinfo").show();
                    $("#delayinfo_content").scrollTop(0);
                }
                */
            });
        }

        function closeDelayInfo() {
            $("#delayinfo").hide();
        }

        function toggleLines(dir) {
            if (dir == 'up') {
                $("#lineWrapDown").css("top", "-"+$("#lineWrapDown").height()+"px").show();

                $("#lineWrapUp").animate({top: "-"+$("#lineWrapUp").height()+"px"}, "fast", "linear", function() {

                });

                $("#lineList").animate({top: "-"+($("#lineList").height()+window.innerHeight)+"px"}, "fast", "linear", function() {
                    $("#lineWrapDown").animate({top: "0px"}, "fast", "linear");
                    $("#linesDiv").css("height", "57px");
                });
            } else {
                onResize();

                $("#lineWrapUp").css("top", "-"+$("#lineWrapUp").height()+"px").show();

                $("#lineWrapDown").animate({top: "-"+$("#lineWrapDown").height()+"px"}, "fast", "linear", function() {
                    $("#lineList").animate({top: "60px"}, "fast", "linear", function() {
                        $("#lineWrapUp").animate({top: "0px"}, "fast", "linear");
                    });
                });
            }
        }

        function onResize() {
            if ($.fullscreen.isFullScreen()) {
                $("#linesDiv").css("height", window.innerHeight - 160);
                $("#lineList").css("height", window.innerHeight - 240);
                $("#lineswrap").css("height", window.innerHeight - 290);
            } else {
                $("#linesDiv").css("height", window.innerHeight - 280);
                $("#lineList").css("height", window.innerHeight - 380);
                $("#lineswrap").css("height", window.innerHeight - 420);
            }

            $("#subwaymap_svg").css("width", window.innerWidth);
            $("#subwaymap_svg").css("height", window.innerHeight);

            var fullWidth = $("#topInfo").width() - 30;
            $("#scrollInfo").css("width", fullWidth - $("#linksInfo").width() - 130);
            $("#scrollInfo").css("overflow", "hidden");
        }

        $(function() {
            onResize();
            
            $(document).bind('fscreenchange', function(e, state, elem) {
                if ($.fullscreen.isFullScreen()) {
                    $("#navbar").hide();
                    $("#navbottom").hide();
                    $("#stationForm").css("top", 20);
                    $("#searchForm").css("top", 20);
                    $("#linesDiv").css("top", 0);
                    //$("#lineWrap").css("top", 0);
                    //$("#lineList").css("top", 60);
                    $("#realSwitch").css("top", 20);
                    $("#zoomBtns").css("bottom", 10);

                    $("#fullicon").attr("src", "http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/fulloff.png");    
                } else {
                    $("#navbar").show();
                    $("#navbottom").show();
                    $("#stationForm").css("top", 120);
                    $("#searchForm").css("top", 120);
                    $("#linesDiv").css("top", 100);
                    //$("#lineWrap").css("top", 100);
                    //$("#lineList").css("top", 160);
                    $("#realSwitch").css("top", 120);
                    $("#zoomBtns").css("bottom", 40);

                    $("#fullicon").attr("src", "http://map.bjsubway.com:8080/subwaymap2/public/subwaymap/fullon.png");
                }
            });

            $(window).bind("resize", function() {
                onResize();
            });
        });
    </script>

            </body>
</html>
09/15 19:56:54 INFO  c.gyzh.zain.vertx.BootstrapVerticle - 部署client.bot成功
09/15 19:56:54 INFO  c.gyzh.zain.vertx.BootstrapVerticle - 全部部署成功

```